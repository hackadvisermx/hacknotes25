# No Padding, No Problem

Oracles can be your best friend, they will decrypt anything, except the flag's ciphertext. How will you break it? Connect with `nc mercury.picoctf.net 33780`.


# Solucion

- Si no hay padding RSA es homorfico

https://es.wikipedia.org/wiki/Cifrado_homom%C3%B3rfico

- la entrada se descencripta
  
m = c^d mod(n)

- No conocemos la lleve privada, pero tenemos c y n, como truqueamos al programa para c como etrada? asumimos est
  
c^d mod(n) = (c+n)^d mod(n)

- Entonces calculams c+n y le damos eso como entrada

  
```bash

┌──(kali㉿kali)-[~]
└─$ nc mercury.picoctf.net 33780

Welcome to the Padding Oracle Challenge

This oracle will take anything you give it and decrypt using RSA. It will not accept the ciphertext with the secret message... Good Luck!

n: 98823706023733942526499024771498817000961669560777320232064681593821612906960931587645291176115874213437278945405303352499556190467935306473864646430520524542851559411589079642231631530207389542293104486865648012913253022765222446819234385215532621158190840290092593401559852281142380836373493644110489948111

e: 65537

ciphertext: 36952606058067533235898033315648869456059850434811823037366003812274063815392016861959081948025048615777397669770724952429114572493289680730417373657369065208087395529673843178423475336285031860004780024501553916286261418321419619698673160821498710242019792907913289267096692011774890055442073605484264005505


Give me ciphertext to decrypt: 135776312081801475762397058087147686457021519995589143269430685406095676722352948449604373124140922829214676615176028304928670762961224987204282020087889589750938954941262922820655106866492421402297884511367201929199514441086642066517907546037031331400210633198005882668656544292917270891815567249594753953616

Here you go: 290275030195850039473456618367455885069965748851278076756743720446703314517401359267322769037469251445384354856017744835453

Give me ciphertext to decrypt:

```

``` bash
┌──(kali㉿kali)-[~]
└─$ python3

Python 3.9.10 (main, Feb 22 2022, 13:54:07)
[GCC 11.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.

>>> n = 98823706023733942526499024771498817000961669560777320232064681593821612906960931587645291176115874213437278945405303352499556190467935306473864646430520524542851559411589079642231631530207389542293104486865648012913253022765222446819234385215532621158190840290092593401559852281142380836373493644110489948111

>>> c = 36952606058067533235898033315648869456059850434811823037366003812274063815392016861959081948025048615777397669770724952429114572493289680730417373657369065208087395529673843178423475336285031860004780024501553916286261418321419619698673160821498710242019792907913289267096692011774890055442073605484264005505

>>> c + n

135776312081801475762397058087147686457021519995589143269430685406095676722352948449604373124140922829214676615176028304928670762961224987204282020087889589750938954941262922820655106866492421402297884511367201929199514441086642066517907546037031331400210633198005882668656544292917270891815567249594753953616

>>> m = 290275030195850039473456618367455885069965748851278076756743720446703314517401359267322769037469251445384354856017744835453

>>> from Crypto.Util.number import long_to_bytes

>>> long_to_bytes(m)

b'picoCTF{m4yb3_Th0se_m3s54g3s_4r3_difurrent_0801973}'

>>>

```

### Way 2 (intented)
  
- Unpadded RSA is homomorphic lo cual significa que https://en.wikipedia.org/wiki/Homomorphic_encryption
https://es.wikipedia.org/wiki/Cifrado_homom%C3%B3rfico

encriptar(m1) * encriptar(m2) = ( (m1 ^ e) * ( m2 ^ e) ) ^ e mod n = encriptar( m1 * m2)

- Entonces

```bash
┌──(kali㉿kali)-[~]
└─$ nc mercury.picoctf.net 33780

Welcome to the Padding Oracle Challenge

This oracle will take anything you give it and decrypt using RSA. It will not accept the ciphertext with the secret message... Good Luck!
  
n: 112186117213555591895736284785117025650586194259766679684546933883561566307918389455420797015432845534349220758642863741487816194536535409849779084155014104149456907557963588052253626359127023933078602314515475751362406343944401748847125513941075227383782186761124626661957429373026367529801821359350773741729

e: 65537

ciphertext: 72182975516225141184435160820115243919451007458434870440386322697588840215938605759899623056642780756517235739750988521577452851863349020432631479233269518517882612535562694519188332732257336905467257279100901477805639603456274076810579775044341209301767714962973524220795470334347584228694245284139158108629

Give me ciphertext to decrypt: 6623748672777840829555717813268202225089035918860595243372859845954294947619447447785502002257889745236448228171882469860538867831250731933102118499939942555742106765649542967040047953183611409486432094743030066584072809456002027704875693944554211050139966205484218852101160993121298312153185794581438616948774970420996281745584946883822660188075077944850194842011506397724867241874986050260402505097880745469469111426816408463161599826792584441721443319816837764164150112518813289152058034020827595393533691172279919985543763202961188017389611990040226771693242186029175638558134539480640097122187962450758852630925

Here you go: 580550060391700078946913236734911770139931497702556153513487440893406629034802718534645538074938502890768709712035489670906

Give me ciphertext to decrypt:
```

- Tomamos un valor como 2 y lo encriptamos, ejecutando
 
2 ^ e mod n

  ```bash
>>> n = 112186117213555591895736284785117025650586194259766679684546933883561566307918389455420797015432845534349220758642863741487816194536535409849779084155014104149456907557963588052253626359127023933078602314515475751362406343944401748847125513941075227383782186761124626661957429373026367529801821359350773741729

>>> e = 65537

>>> c = 72182975516225141184435160820115243919451007458434870440386322697588840215938605759899623056642780756517235739750988521577452851863349020432631479233269518517882612535562694519188332732257336905467257279100901477805639603456274076810579775044341209301767714962973524220795470334347584228694245284139158108629

>>> x = pow(2, e, n)
  
```

- luego calculamos c * x:
- Como se explico

  c * x = encriptar(m) * encriptar(2) = encriptar(m * 2)

```bash
>>> c * x

6623748672777840829555717813268202225089035918860595243372859845954294947619447447785502002257889745236448228171882469860538867831250731933102118499939942555742106765649542967040047953183611409486432094743030066584072809456002027704875693944554211050139966205484218852101160993121298312153185794581438616948774970420996281745584946883822660188075077944850194842011506397724867241874986050260402505097880745469469111426816408463161599826792584441721443319816837764164150112518813289152058034020827595393533691172279919985543763202961188017389611990040226771693242186029175638558134539480640097122187962450758852630925
>>>
```

- Se lo pasamos al programa para que lo decripte

```bash
Give me ciphertext to decrypt: 6623748672777840829555717813268202225089035918860595243372859845954294947619447447785502002257889745236448228171882469860538867831250731933102118499939942555742106765649542967040047953183611409486432094743030066584072809456002027704875693944554211050139966205484218852101160993121298312153185794581438616948774970420996281745584946883822660188075077944850194842011506397724867241874986050260402505097880745469469111426816408463161599826792584441721443319816837764164150112518813289152058034020827595393533691172279919985543763202961188017389611990040226771693242186029175638558134539480640097122187962450758852630925

Here you go: 580550060391700078946913236734911770139931497702556153513487440893406629034802718534645538074938502890768709712035489670906
```

- lo que obtenemos es m * 2 , tomamos el resultado y lo dividimos entre 2 para obtener m de regreso
```bash
>>> m = 580550060391700078946913236734911770139931497702556153513487440893406629034802718534645538074938502890768709712035489670906 // 2
>>> m
290275030195850039473456618367455885069965748851278076756743720446703314517401359267322769037469251445384354856017744835453
```

- Decriptamos el valor
  ```bash
>>>
>>> 
>>> long_to_bytes(m)

b'picoCTF{m4yb3_Th0se_m3s54g3s_4r3_difurrent_0801973}'

```

## Ligas

- padding oracle attack : https://en.wikipedia.org/wiki/Padding_oracle_attack
- homomorphic encryption : https://en.wikipedia.org/wiki/Homomorphic_encryption
