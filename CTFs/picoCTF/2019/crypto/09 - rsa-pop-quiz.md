
#  rsa-pop-quiz

Class, take your seats! It's PRIME-time for a quiz... `nc jupiter.challenges.picoctf.org 58617`

## Solucion

### Teoria
- [Criptografía asimétrica](https://es.wikipedia.org/wiki/Criptograf%C3%ADa_asim%C3%A9trica)
- [RSA](https://es.wikipedia.org/wiki/RSA)
 

```
- Alicia envía a Bob una caja con un candado abierto del que solo Alicia tiene la llave

- Bob recibe la caja, escribe el mensaje, lo pone en la caja, y la cierra con su candado.
	- ahora Bob no puede leer el mensaje

- Bob envía la caja a Alicia y ella la abre con su llave.

- En este ejemplo la caja con el candado es la "llave publica" de Alicia y la llave del 
  candado es su "clave privada"

Técnicamente: 

Bob envía a Alicia un <texto plano> M en forma de un numero m menor que otro n, mediante un protocolo 
reversible conocido como padding scheme (patron de relleno). A continuación genera el "mensaje cifrado" c mediante la siguiente operación:
```

- las formulas

```
c = m ^ e (mod n)

c - mensaje cifrado
m - mensaje texto plano
e - clave publica
n - 

Ahora Alicia descifra el "mensaje cifrado" c mediante la operacion inversa dada por:

m = c ^ d   (mod n)

d - es la clave privada que solo Alicia conoce
```

### Procedimiento


Google> RSA
MisNotas> Poner


```
RSA
c - texto cifrado
m - mensaje texto plano
p - primo 1
q - primo 2  
d - llave privada
e - llave publica (exponente) (2 ^ 16 + 1 = 65537 )
n - modulo para llave publica y llave privada
tn - totient de n (funcion de euler)

Calcular
n = p * q
tn = (p-1)(q-1)
d = e  invmod tn    / pow(e,-1,tn)

Encriptar:
c = m ^ e (mod n)   / pow(m,e,n)
 
Desencriptar:
m = c ^ d (mod n) / pow(c,d,n)

```

Instalar> pip install pycryptodome

Alt + 6, Ctrl +u ... copiar y pegar en nano

nc 2019shell1.picoctf.com 2611

para operaciones.    : expr
o también pueden ser : sudo apt install bc

#### Paso 1
	p
	q
	n?
	n = p * q
	60413 * 76753

n = 4636878989


#### Paso 2
	p
	n
	
	q ?
	
	q = n  / p
	
	5051846941 / 54269

q = 93089
 

#### Paso 3
	e
	n
	q ?
	p ?
	- Esto no se puede calcular n dificil de factorizar
	 

#### Paso 4
	t(n)=(p-1)(q-1)
	tn = (12611 - 1) * (66347-1)

tn = 836623060


#### Paso 5 
	p
	e
	n

	plain ?

m = c ^ d (mod n)

```
>> m = 6357294171489311547190987615544575133581967886499484091352661406414044440475205342882841236357665973431462491355089413710392273380203038793241564304774271529108729717

>> e = 3

>> n = 29129463609326322559521123136222078780585451208149138547799121083622333250646678767769126248182207478527881025116332742616201890576280859777513414460842754045651093593251726785499360828237897586278068419875517543013545369871704159718105354690802726645710699029936754265654381929650494383622583174075805797766685192325859982797796060391271817578087472948205626257717479858369754502615173773514087437504532994142632207906501079835037052797306690891600559321673928943158514646572885986881016569647357891598545880304236145548059520898133142087545369179876065657214225826997676844000054327141666320553082128424707948750331


>> pow(m,e,n)

256931246631782714357241556582441991993437399558886749996349404042847360908714114002253983722139499330990033762858474217011587871749366792678566825883663438870011663915587342683822921564518371726825959962528148194101893812528187894676959808439247126601859891861727348622381782224490628276354003558239854437272819102931593876044197687944509532353409417174479373903127886460749619552577176382615108244813

```

### Paso 6
	c
	e
	n
	plain ?
	
	d = inv_mod[e,t(n)]
	t(n) = (p-1)(q-1)
	m = c ^ d (mod n
	Dado que para hacer eso necesitariamos la llave privada y para ello p y q, factorizar n es complicado

#### Paso 7
	p
	q
	e

	d ?

```bash
pip install pycryptodome 
```

t(n) = (p-1)(q-1)
d = inv_mod[e,t(n)]
m = c ^ d (mod n)

```python
>> from Crypto.Util.number import inverse
>> p = 97846775312392801037224396977012615848433199640105786119757047098757998273009741128821931277074555731813289423891389911801250326299324018557072727051765547115514791337578758859803890173153277252326496062476389498019821358465433398338364421624871010292162533041884897182597065662521825095949253625730631876637
>> q = 92092076805892533739724722602668675840671093008520241548191914215399824020372076186460768206814914423802230398410980218741906960527104568970225804374404612617736579286959865287226538692911376507934256844456333236362669879347073756238894784951597211105734179388300051579994253565459304743059533646753003894559

>>> tn=(p-1)*(q-1)
>>> e = 65537
>>> ///d = inverse(e,tn)
>>> d = pow(e,-1,tn)
>>> d 
1405046269503207469140791548403639533127416416214210694972085079171787580463776820425965898174272870486015739516125786182821637006600742140682552321645503743280670839819078749092730110549881891271317396450158021688253989767145578723458252769465545504142139663476747479225923933192421405464414574786272963741656223941750084051228611576708609346787101088759062724389874160693008783334605903142528824559223515203978707969795087506678894006628296743079886244349469131831225757926844843554897638786146036869572653204735650843186722732736888918789379054050122205253165705085538743651258400390580971043144644984654914856729

```

#### Paso 8
	p 
	c
	e
	n

	m = ?

tn = (p-1)(q-1)
d = inv_mod[e,tn]
m = c ^ d (mod n)

``` python
>>> p=153143042272527868798412612417204434156935146874282990942386694020462861918068684561281763577034706600608387699148071015194725533394126069826857182428660427818277378724977554365910231524827258160904493774748749088477328204812171935987088715261127321911849092207070653272176072509933245978935455542420691737433
>>> c=23016653876847472700856653975636134833816267659423093220825802730311792688015526031010185862796820464000740538663367868273628190558574669769926145909966799940743138330542504400318814444877763931323239980099404303323064601116168860363364840864265724602533013776878867287027908763538326145208488830881872675088750689066949453757107611076477999369848061893166820131477255959664458909576462597878213732662606021276850039344887619097192724271061026030900796808157479658550935169474101799591059725002019677640101543801616541273658841153594862740548434726220958512298690110880142486139412015047636595600919146971517653734739
>>> e=65537
>>> n=23952937352643527451379227516428377705004894508566304313177880191662177061878993798938496818120987817049538365206671401938265663712351239785237507341311858383628932183083145614696585411921662992078376103990806989257289472590902167457302888198293135333083734504191910953238278860923153746261500759411620299864395158783509535039259714359526738924736952759753503357614939203434092075676169179112452620687731670534906069845965633455748606649062394293289967059348143206600765820021392608270528856238306849191113241355842396325210132358046616312901337987464473799040762271876389031455051640937681745409057246190498795697239

>>> q = n // p
>>> tn = (p - 1) * (q - 1)
>>> d = inverse(e,tn)
>>> m = pow(c,d,n)
>>> m
14311663942709674867122208214901970650496788151239520971623411712977119770832428664762753917
>>> long_to_bytes(m)
b'picoCTF{wA8_th4t$_ill3aGal..o8227181c}'

```
o int to hex, hex to ascii

## Usando pwntools

```bash
sudo apt install python3-pwntools

```

```Python
from pwn import *

with context.quiet: 

    s = remote("jupiter.challenges.picoctf.org", 58617)

    print(s.recvuntil(b'):').decode())
    s.sendline(b'Y')
    print(s.recvuntil(b': ').decode())
    p = 60413
    q = 76753
    n = p * q
    print("n="+str(n))
    s.sendline(str(n).encode())

    print(s.recvuntil(b'):').decode())
    s.sendline(b'Y')
    print(s.recvuntil(b': ').decode())
    p =  54269
    n =  5051846941
    q = n // p
    print("q="+str(q))
    s.sendline(str(q).encode())

    print(s.recvuntil(b'):').decode())
    s.sendline(b'N')

    print(s.recvuntil(b'):').decode())
    s.sendline(b'Y')
    print(s.recvuntil(b': ').decode())
    p =  12611
    q =  66347
    t = (p - 1) * (q - 1)
    print("t="+str(t))
    s.sendline(str(t).encode())

    print(s.recvuntil(b'):').decode())
    s.sendline(b'Y')
    print(s.recvuntil(b': ').decode())
    pt = 6357294171489311547190987615544575133581967886499484091352661406414044440475205342882841236357665973431462491355089413710392273380203038793241564304774271529108729717
    e =  3
    n =  29129463609326322559521123136222078780585451208149138547799121083622333250646678767769126248182207478527881025116332742616201890576280859777513414460842754045651093593251726785499360828237897586278068419875517543013545369871704159718105354690802726645710699029936754265654381929650494383622583174075805797766685192325859982797796060391271817578087472948205626257717479858369754502615173773514087437504532994142632207906501079835037052797306690891600559321673928943158514646572885986881016569647357891598545880304236145548059520898133142087545369179876065657214225826997676844000054327141666320553082128424707948750331
    ct = pow(pt,e,n)
    print("ct="+str(ct))
    s.sendline(str(ct).encode())

    print(s.recvuntil(b'):').decode())
    s.sendline(b'N')

    print(s.recvuntil(b'):').decode())
    s.sendline(b'Y')
    print(s.recvuntil(b': ').decode())
    q = 92092076805892533739724722602668675840671093008520241548191914215399824020372076186460768206814914423802230398410980218741906960527104568970225804374404612617736579286959865287226538692911376507934256844456333236362669879347073756238894784951597211105734179388300051579994253565459304743059533646753003894559
    p = 97846775312392801037224396977012615848433199640105786119757047098757998273009741128821931277074555731813289423891389911801250326299324018557072727051765547115514791337578758859803890173153277252326496062476389498019821358465433398338364421624871010292162533041884897182597065662521825095949253625730631876637
    e =  65537
    n = p * q
    t = (p -1 ) * (q - 1)
    d = pow(e,-1,t)
    print("d="+str(d))
    s.sendline(str(d).encode())

    print(s.recvuntil(b'):').decode())
    s.sendline(b'Y')
    print(s.recvuntil(b': ').decode())
    p = 153143042272527868798412612417204434156935146874282990942386694020462861918068684561281763577034706600608387699148071015194725533394126069826857182428660427818277378724977554365910231524827258160904493774748749088477328204812171935987088715261127321911849092207070653272176072509933245978935455542420691737433
    ct = 15898528329836486259454280642537682745047492250031819804208947573732209296147142448425785475270839697919293976182333838349380319082449313123936042811917218253196274432195116911131311101664245124078266845291992250418272429673592762174381527121624558596357902629676671110003023710107905410987270486412752306303470410502366293287214002128769133995449197216690029130480234844827254205117539992852496638836353167147769854523276743309449394023887611024408163270210444112592577810624181267012402352918669635578760260278590557042623644240179185252741450067430771092134328724271261927055861090533852597204599189199436235384288
    e =  65537
    n = 23952937352643527451379227516428377705004894508566304313177880191662177061878993798938496818120987817049538365206671401938265663712351239785237507341311858383628932183083145614696585411921662992078376103990806989257289472590902167457302888198293135333083734504191910953238278860923153746261500759411620299864395158783509535039259714359526738924736952759753503357614939203434092075676169179112452620687731670534906069845965633455748606649062394293289967059348143206600765820021392608270528856238306849191113241355842396325210132358046616312901337987464473799040762271876389031455051640937681745409057246190498795697239
    q = n // p
    t = (p-1) * (q-1)
    d = pow(e,-1,t)
    pt =  pow(ct,d,n)
    print("pt="+str(pt))
    s.sendline(str(pt).encode())

    print(s.recvall().decode())

    flag = bytes.fromhex(hex(pt)[2:]).decode()

    print(flag)

```


## Referencias

- asymmetric cryptography | public-key cryptography: https://en.wikipedia.org/wiki/Public-key_cryptography
-

- Mi video: https://drive.google.com/drive/folders/1Jn24WwUKxRzziKKk6aaxj6wl5OZu8tkn

- pwntools > https://blog.eadom.net/uncategorized/pwntools-quick-reference-guide/